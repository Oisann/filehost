<!DOCTYPE html>
<html>

<head>
    <script type="text/javascript" class="jsbin" src="https://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
    <script type="text/javascript" class="jsbin" src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.0/jquery-ui.min.js"></script>
    <meta charset="utf-8">
    <title>upload</title>
    <script type="text/javascript">
        function upload() {
            var file = $('#testFile').prop('files')[0];
            var filepath = $('#testFile').prop("files")[0]['name'];
            var type = $("#testFile").prop('files')[0].type.split("/")[1];
            console.log(file);
            $.ajax({
                url: "{{.BaseURL}}upload?key={{.Key}}",
                type: "POST",
                data: file,
                headers: {
                    "file-type": type
                },
                processData: false,
                xhr: function() {
                    var xhr = $.ajaxSettings.xhr();
                    if (xhr.upload) {
                        xhr.upload.addEventListener('progress', function(event) {
                            var percent = 0;
                            var position = event.loaded || event.position;
                            var total = event.total;
                            if (event.lengthComputable) {
                                percent = Math.ceil(position / total * 100);
                            }
                            //update progressbar
                            $("#progress").html(percent + "%");
                            console.log(percent);
                        }, true);
                    }
                    return xhr;
                },
                success: function(msg) {
                    console.log(msg);
                    document.getElementById("link").innerHTML = '<a href="' + msg + '">' + msg + '</a>';
                }
            });
        };
    </script>
    <style type="text/css">
        #progress {
            float: left;
        }

        #testFile {
            float: left;
        }

        #link {
            clear: both;
        }
    </style>
</head>

<body>
    <input id="testFile" type='file' onchange="upload()">
    <div id="progress"></div>
    <div id="link"></div>
</body>

</html>
